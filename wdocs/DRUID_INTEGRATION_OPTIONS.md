# Варианты интеграции Druid Connection Pool в WildFly

## Проблема

WildFly управляет datasource через свой механизм (IronJacamar), и нельзя просто зарегистрировать DataSource в JNDI из приложения.

## Варианты решения

### Вариант 1: Non-JTA Datasource (RESOURCE_LOCAL) ✅ РЕКОМЕНДУЕТСЯ

**Плюсы:**
- ✅ Гарантированно работает
- ✅ Использует Druid напрямую
- ✅ Полный контроль над пулом соединений

**Минусы:**
- ⚠️ Нужно управлять транзакциями вручную (EntityTransaction)
- ⚠️ Не работает с JTA транзакциями автоматически

**Реализация:**
- Изменить `persistence.xml`: `transaction-type="RESOURCE_LOCAL"`
- Использовать `EntityManager.getTransaction()` для управления транзакциями

### Вариант 2: Обертка через WildFly Resource Adapter

**Плюсы:**
- ✅ Работает с JTA
- ✅ Использует Druid

**Минусы:**
- ❌ Сложная настройка
- ❌ Требует создания custom resource adapter

### Вариант 3: Использовать Druid как мониторинг поверх WildFly datasource

**Плюсы:**
- ✅ Простая реализация
- ✅ Работает с JTA

**Минусы:**
- ⚠️ Фактически используется WildFly pool, а не Druid
- ⚠️ Может не соответствовать жесткому требованию

### Вариант 4: Использовать Druid XA DataSource

**Плюсы:**
- ✅ Поддержка распределенных транзакций
- ✅ Использует Druid

**Минусы:**
- ❌ Druid не имеет встроенной поддержки XA
- ❌ Нужна сложная обертка

## Рекомендация

Для **жесткого требования** использовать Druid рекомендую **Вариант 1** (RESOURCE_LOCAL):

1. Это гарантированно работает
2. Druid используется напрямую
3. Все параметры Druid применяются
4. Можно показать в отчете реальное использование Druid

Единственный недостаток - нужно управлять транзакциями вручную, но это не критично для большинства операций.

