# Инструкция по запуску JMeter теста

## Быстрый старт

### 1. Установка JMeter (если еще не установлен)

**macOS:**
```bash
brew install jmeter
```

**Linux:**
```bash
sudo apt-get install jmeter
# или
sudo yum install jmeter
```

**Windows:**
Скачайте с https://jmeter.apache.org/download_jmeter.cgi и распакуйте архив.

### 2. Подготовка

Убедитесь, что:
- Backend приложение запущено на WildFly (порт 8080)
- MinIO запущен и доступен
- База данных работает

### 3. Запуск теста

Перейдите в корневую директорию проекта и выполните:

```bash
cd /Users/macbookair2020/Downloads/HumanRegistry

jmeter -n -t jmeter/distributed-transaction-test.jmx \
       -Jjmeter.dir=$(pwd)/jmeter \
       -JSERVER_HOST=localhost \
       -JSERVER_PORT=8080 \
       -l jmeter/results.jtl \
       -e -o jmeter/report
```

**Важно:** Используйте `$(pwd)/jmeter` для указания абсолютного пути к директории с JSON файлами.

### 4. Просмотр результатов

После завершения теста откройте HTML отчет:

```bash
open jmeter/report/index.html
```

Или просто откройте файл `jmeter/report/index.html` в браузере.

## Что делает тест

- Запускает **5 параллельных потоков** (пользователей)
- Каждый поток отправляет **POST запрос** на `/api/import/humanbeings/file`
- Каждый запрос загружает **разный JSON файл** (test1.json, test2.json, test3.json)
- Все запросы выполняются **одновременно** для проверки распределенных транзакций

## Проверка результатов

После выполнения теста:

1. **В приложении** проверьте:
   - Раздел "Human Beings" - должны появиться новые записи
   - Раздел "Импорт" → "История" - должны быть записи об импорте

2. **В MinIO** (http://localhost:9001):
   - Bucket `import-files` должен содержать загруженные файлы

3. **В HTML отчете JMeter**:
   - Все запросы должны быть успешными (зеленые)
   - HTTP статус должен быть 200
   - Время ответа должно быть разумным

## Настройка параметров

Если нужно изменить параметры, используйте флаги `-J`:

```bash
# Изменить хост сервера
-JSERVER_HOST=192.168.1.100

# Изменить порт
-JSERVER_PORT=8080

# Изменить количество потоков (нужно редактировать JMX файл)
```

## Запуск через GUI (для отладки)

Если нужно посмотреть детали выполнения:

```bash
jmeter jmeter/distributed-transaction-test.jmx
```

В GUI:
1. Откройте Thread Group
2. В CSV Data Set Config укажите путь: `$(pwd)/jmeter/test_files.csv` или абсолютный путь
3. Нажмите Start (▶)

## Структура файлов

```
jmeter/
├── distributed-transaction-test.jmx  # Тест-план
├── test_files.csv                    # Список JSON файлов
├── test1.json                        # Тестовые данные 1
├── test2.json                        # Тестовые данные 2
├── test3.json                        # Тестовые данные 3
├── results.jtl                       # Результаты (создается после запуска)
└── report/                           # HTML отчет (создается после запуска)
```

## Важные замечания

1. **Путь к файлам**: JMeter должен видеть JSON файлы. Используйте абсолютный путь через `$(pwd)/jmeter`

2. **Порты**: Убедитесь, что порт 8080 свободен и на нем запущен WildFly

3. **MinIO**: Должен быть запущен и доступен, иначе транзакции будут откатываться

4. **База данных**: Должна быть доступна, иначе транзакции не смогут закоммититься


